
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Presupuesto ¬∑ Vanilla</title>

  <!-- html2pdf bundle (html2canvas + jsPDF) -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --bg: #0b0c10;
      --panel: #111318;
      --muted: #9aa3b2;
      --text: #e6edf3;
      --accent: #5ac8fa;
      --warn: #fbbf24;
      --border: #242936;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
      background: radial-gradient(1200px 600px at 10% -10%, #182033 0%, #0b0c10 50%, #0b0c10 100%);
      color: var(--text);
    }

    .container {
      max-width: 1100px; margin: 24px auto; padding: 16px; display: grid; gap: 16px;
      grid-template-columns: 380px 1fr; align-items: start;
    }

    .card {
      background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    h1 { font-size: 22px; margin: 0 0 6px; font-weight: 700; letter-spacing: .2px; }
    h2 { font-size: 14px; margin: 0 0 12px; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: .8px; }
    label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    input[type="text"], input[type="number"], input[type="date"], textarea {
      width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #0e1116; color: var(--text);
      outline: none; transition: border-color .15s ease;
    }
    input:focus, textarea:focus { border-color: var(--accent); }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .items { display: grid; gap: 10px; margin-top: 8px; }
    .item-card {
      display: grid; grid-template-columns: 100px 1fr 140px 40px; gap: 10px; align-items: end;
      background: #0f1218; border: 1px dashed #2a3243; border-radius: 12px; padding: 10px;
    }
    .remove { justify-self: end; }

    .totals { display: grid; grid-template-columns: 1fr auto; align-items: center; margin-top: 12px; }
    .badge { font-variant-numeric: tabular-nums; font-weight: 700; }

    /* PDF area styling */
    .preview-wrap { position: sticky; top: 16px; }
    .pdf {
      width: 210mm; min-height: 297mm; margin: 0 auto; background: #ffffff; color: #111826; border-radius: 10px; overflow: hidden;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
    }
    .pdf .page { padding: 22mm 18mm; }

    .pdf h3 { margin: 0 0 8px; font-size: 16px; color: #0f172a; }
    .pdf .meta { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 14px; font-size: 13px; }
    .pdf .meta .field { display: flex; gap: 6px; }
    .pdf .meta .label { color: #334155; width: 90px; }

    .pdf table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .pdf thead th {
      text-align: center; background: #f1f5f9; color: #0f172a; padding: 10px; border: 1px solid #000000; font-weight: 700;
    }
    .pdf tbody td { padding: 9px 10px; border: 1px solid #000000; }
    .pdf tfoot td { padding: 10px; font-weight: 800; }
    .pdf .right { text-align: center; }

    .info {
      margin-top: 16px; border: 1px solid #000000; border-radius: 8px; padding: 12px; background: #f8fafc;
      font-size: 12px; color: #334155;
    }
    .info h4 { margin: 0 0 8px; font-size: 12px; color: #111827; }
    .info ul { margin: 0; padding-left: 18px; }
    .info li { margin: 4px 0; }

    .pdf-footer { margin-top: 10px; font-size: 11px; color: #475569; display: flex; justify-content: space-between; }

    .toolbar { display: flex; gap: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <section class="card">
      <h1>Generador de Presupuestos</h1>
      <h2>Formulario</h2>

      <div class="row">
        <div>
          <label>Cliente</label>
          <input id="customer" type="text" placeholder="Nombre del cliente" />
        </div>
        <div>
          <label>Direcci√≥n</label>
          <input id="address" type="text" placeholder="Direcci√≥n" />
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div>
          <label>Fecha</label>
          <input id="date" type="date" />
        </div>
        <div>
          <label>Moneda (visual)</label>
          <input id="currency" type="text" value=" $" />
        </div>
      </div>

      <div style="margin-top: 14px; display:flex; justify-content: space-between; align-items: center;">
        <h2 style="margin:0">√çtems</h2>
        <button class="btn" id="addItem">‚ûï Agregar √≠tem</button>
      </div>

      <div id="items" class="items"></div>

      <div class="totals">
        <small class="muted">Se calcula autom√°ticamente</small>
        <div class="badge" id="totalBadge">Total: 0,00 $</div>
      </div>

      <div class="toolbar">
        <button class="btn" id="seed">üìã Cargar ejemplo</button>
        <button class="btn primary" id="download">üßæ Descargar PDF</button>
      </div>
    </section>

    <aside class="preview-wrap">
      <div class="card">
        <h2>Vista previa</h2>
        <div id="pdfTarget" class="pdf">
          <div class="page">
            <h3>Presupuesto</h3>
            <div class="meta">
              <div class="field"><div class="label">Cliente:</div><div id="pvCustomer">‚Äî</div></div>
              <div class="field"><div class="label">Fecha:</div><div id="pvDate">‚Äî</div></div>
              <div class="field"><div class="label">Direcci√≥n:</div><div id="pvAddress">‚Äî</div></div>
            </div>

            <table>
              <thead>
                <tr>
                  <th style="width: 70px;">Cant</th>
                  <th>Descripci√≥n</th>
                  <th class="right" style="width: 130px;">Precio unidad</th>
                  <th class="right" style="width: 120px;">Total</th>
                </tr>
              </thead>
              <tbody id="pvBody"></tbody>
              <tfoot>
                <tr>
                  <td colspan="3" class="right">TOTAL</td>
                  <td class="right" id="pvGrand">0,00 $</td>
                </tr>
              </tfoot>
            </table>

            <div class="info">
              <h4>Informaci√≥n</h4>
              <ul>
                <li>El siguiente presupuesto no incluye IVA.</li>
                <li>Al momento de aprobar el presupuesto debe cancelar el 80% del monto total y el 20% restante al momento de culminar el trabajo.</li>
                <li>M√©todos de pago: aceptamos efectivo en divisa, transferencias nacionales como Banesco, Provincial, Mercantil, Venezolano de Cr√©dito y Banco de Venezuela.</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="toolbar" style="margin-top:12px">
          <button class="btn ghost" id="download2">‚¨áÔ∏è Descargar PDF</button>
        </div>
      </div>
    </aside>
  </div>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const toNumber = (v) => {
      if (typeof v === 'number' && !isNaN(v)) return v;
      const n = parseFloat(String(v).replace(/,/g, '.'));
      return isNaN(n) ? 0 : n;
    };
    const fmtVE = (n, sym) => toNumber(n).toLocaleString('es-VE', {minimumFractionDigits:2, maximumFractionDigits:2}) + (sym || ' $');

    const state = {
      customer: '',
      address: '',
      currency: ' $',
      date: new Date(),
      items: [{qty: 1, desc: '', price: 0}]
    };

    const els = {
      customer: $('#customer'),
      address: $('#address'),
      date: $('#date'),
      currency: $('#currency'),
      items: $('#items'),
      addItem: $('#addItem'),
      seed: $('#seed'),
      download: $('#download'),
      download2: $('#download2'),
      totalBadge: $('#totalBadge'),
      pvCustomer: $('#pvCustomer'),
      pvAddress: $('#pvAddress'),
      pvDate: $('#pvDate'),
      pvTotal: $('#pvTotal'),
      pvBody: $('#pvBody'),
      pvGrand: $('#pvGrand'),
      pdfTarget: $('#pdfTarget')
    };

    // Init date input to today
    const iso = new Date(Date.now() - new Date().getTimezoneOffset()*60000).toISOString().slice(0,10);
    els.date.value = iso;

    function dateHuman(d) {
      const dia = d.getDate().toString().padStart(2, '0');
      const mes = d.toLocaleString('es-ES', { month: 'short' }).replace('.', '');
      const yy = String(d.getFullYear()).slice(-2);
      return `${dia}-${mes}-${yy}`;
    }

    function renderItems() {
      els.items.innerHTML = '';
      els.pvBody.innerHTML = '';

      state.items.forEach((it, i) => {
        // form row
        const wrap = document.createElement('div');
        wrap.className = 'item-card';
        wrap.innerHTML = `
          <div>
            <label>Cantidad</label>
            <input type="number" min="0" step="1" value="${it.qty}" data-i="${i}" data-k="qty" />
          </div>
          <div>
            <label>Descripci√≥n</label>
            <input type="text" value="${it.desc}" placeholder="Ej: Ucaros" data-i="${i}" data-k="desc" />
          </div>
          <div>
            <label>Precio unidad</label>
            <input type="number" min="0" step="0.01" value="${it.price}" data-i="${i}" data-k="price" />
          </div>
          <div class="remove"><button class="btn warn" data-remove="${i}">‚úï</button></div>
        `;
        els.items.appendChild(wrap);

        // preview row
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${it.qty}</td>
          <td>${it.desc}</td>
          <td class="right">${fmtVE(it.price, state.currency)}</td>
          <td class="right">${fmtVE(it.qty * it.price, state.currency)}</td>
        `;
        els.pvBody.appendChild(tr);
      });

      const total = state.items.reduce((a, it) => a + toNumber(it.qty) * toNumber(it.price), 0);
      els.totalBadge.textContent = `Total: ${fmtVE(total, state.currency)}`;
      els.pvGrand.textContent = fmtVE(total, state.currency);
      els.pvTotal.textContent = fmtVE(total, state.currency);
    }

    function bindEvents() {
      els.customer.addEventListener('input', (e) => { state.customer = e.target.value; els.pvCustomer.textContent = state.customer || '‚Äî'; });
      els.address.addEventListener('input', (e) => { state.address = e.target.value; els.pvAddress.textContent = state.address || '‚Äî'; });
      els.currency.addEventListener('input', (e) => { state.currency = e.target.value || ' $'; renderItems(); });
      els.date.addEventListener('input', (e) => {
        state.date = new Date(e.target.value);
        els.pvDate.textContent = dateHuman(state.date);
      });

      els.items.addEventListener('input', (e) => {
        const i = Number(e.target.getAttribute('data-i'));
        const k = e.target.getAttribute('data-k');
        if (k === 'desc') {
          state.items[i].desc = e.target.value;
        } else {
          state.items[i][k] = toNumber(e.target.value);
        }
        renderItems();
      });

      els.items.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-remove]');
        if (!btn) return;
        const i = Number(btn.getAttribute('data-remove'));
        state.items.splice(i, 1);
        if (!state.items.length) state.items = [{qty:1, desc:'', price:0}];
        renderItems();
      });

      els.addItem.addEventListener('click', () => {
        state.items.push({qty:1, desc:'', price:0});
        renderItems();
      });

      const seed = () => {
        state.customer = 'Atenci√≥n Angela Janji';
        state.address = 'Prados del este';
        state.items = [
          { qty: 2, desc: 'Ucaros', price: 80 },
          { qty: 10, desc: 'Pileas', price: 6 },
          { qty: 3, desc: 'Sacos de tierra', price: 6 },
          { qty: 1, desc: 'Transporte', price: 20 }
        ];
        els.customer.value = state.customer;
        els.address.value = state.address;
        renderItems();
        els.pvCustomer.textContent = state.customer;
        els.pvAddress.textContent = state.address;
      };
      els.seed.addEventListener('click', seed);

      async function download() {
        const el = els.pdfTarget;
        const filename = `Presupuesto-${state.customer || 'cliente'}-${dateHuman(state.date)}.pdf`;
        const opt = {
          margin: [8,8,8,8],
          filename,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2, useCORS: true },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        await new Promise(r => setTimeout(r, 50));
        window.html2pdf().set(opt).from(el).save();
      }
      els.download.addEventListener('click', download);
      els.download2.addEventListener('click', download);
    }

    // Initial render
    els.pvDate.textContent = dateHuman(state.date);
    bindEvents();
    renderItems();
  </script>
</body>
</html>
